%script{:type => "text/javascript", :charset => "utf-8"}
  var jobs =
  =raw @jobs.map { |job| { :lat => job.company.lat, :lng => job.company.long}}.to_json
  ;
  $(document).ready(function() {setupMap(jobs);});
.wide-column
  = render 'jobsearchbox'
  .inner-sidebar
    =form_for @search do |f|
      .filter-box.smart-filter-enable
        #smart-filter
          .smart-filter-title
            %span
              Smart Filters
            %a{ :href => '#' }What's this?
          %input{:type => 'button', :class => 'smart-filter-toggle toggle-off'}
        %br.clearit

      .filter-box.date.can-hide
        .filter-title
          Job Post Age
        .filter-footer
          =select :search, :date_acquired_greater_than, [ ["1 week ago", (Date.today - 7.days).to_s],["2 weeks ago", (Date.today - 14.days).to_s],["1 month ago", (Date.today - 30.days).to_s],["2 months ago", (Date.today - 60.days).to_s],["3 months ago", (Date.today -   90.days).to_s],["1 year ago", (Date.today - 356.days).to_s]], :include_blank => 'None'
      .filter-box.keyword.can-hide
        .filter-title
          Search
        .filter-footer
          =f.text_field :job_searches_keyword_contains

      .filter-box.location.can-hide
        .filter-title
          Location
        .filter-footer
          =f.text_field :job_searches_location_contains

      .filter-box.title.can-hide
        .filter-title
          Title Contains
        .filter-footer
          =f.text_field :title_contains

      .filter-box.companies.can-hide
        .filter-title
          Company Name Contains
        .filter-footer
          =f.text_field :company_name_contains
          =f.submit "Submit", :value=>"Search", :class => "green-btn"

  .white-box.search-results-wrapper
    .search-results-header
      .search-result-title
        %span
          =@jobs.total_entries unless @jobs.blank?
        Jobs Found
      .search-result-sortby
        Sort by:
        %select
          %option{ :value => '1' }
            Relevance
          %option{ :value => '2' }
            Distance
          %option{ :value => '3' }
            Salary
    %ol.job-listings
      = render 'joblisting'
    =will_paginate @jobs unless @jobs.blank?

#sidebar
  = render 'jobmap'
  - if current_user && params[:search]
    .cta-box.current-search
      .cta-title
        Current Search
      %ul
        %li
          = "#{params[:search][:job_searches_keyword_contains]}"
          - if params[:search][:job_searches_location_contains]
            - if params[:search][:job_searches_location_contains].empty?
              = " (anywhere)"
            - else
              = "near #{params[:search][:job_searches_location_contains]}"
      = form_tag('/job_searches_user/new', :method => :get, :id => 'save-search')
      .cta-footer
        = hidden_field_tag 'search[date_acquired_greater_than]', params[:search][:date_acquired_greater_than]
        = hidden_field_tag 'search[job_searches_keyword_contains]', params[:search][:job_searches_keyword_contains]
        = hidden_field_tag 'search[job_searches_location_contains]', params[:search][:job_searches_location_contains]
        = hidden_field_tag 'search[title_contains]', params[:search][:title_contains]
        = hidden_field_tag 'search[company_name_contains]', params[:search][:company_name_contains]
        = submit_tag 'Save this search', {:class => 'green-btn'}
        %a{ :href => '#'}
          What's this?

    = render 'savedsearches'
%br
